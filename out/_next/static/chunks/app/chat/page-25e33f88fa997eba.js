(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[457],{3724:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>w});var s=r(5155),a=r(2115),n=r(63),l=r(7910),c=r(4926),o=r(8085),i=r(5937),d=r(7003),u=r(6170),f=r(2912),m=r(5016);let h=a.forwardRef((e,t)=>{let{className:r,children:a,...n}=e;return(0,s.jsxs)(f.bL,{ref:t,className:(0,m.cn)("relative overflow-hidden",r),...n,children:[(0,s.jsx)(f.LM,{className:"h-full w-full rounded-[inherit]",children:a}),(0,s.jsx)(x,{}),(0,s.jsx)(f.OK,{})]})});h.displayName=f.bL.displayName;let x=a.forwardRef((e,t)=>{let{className:r,orientation:a="vertical",...n}=e;return(0,s.jsx)(f.VM,{ref:t,orientation:a,className:(0,m.cn)("flex touch-none select-none transition-colors","vertical"===a&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===a&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",r),...n,children:(0,s.jsx)(f.lr,{className:"relative flex-1 rounded-full bg-border"})})});x.displayName=f.VM.displayName;var g=r(7870);let p=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(g.bL,{ref:t,className:(0,m.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",r),...a})});p.displayName=g.bL.displayName,a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(g._V,{ref:t,className:(0,m.cn)("aspect-square h-full w-full",r),...a})}).displayName=g._V.displayName;let b=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(g.H4,{ref:t,className:(0,m.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",r),...a})});b.displayName=g.H4.displayName;var v=r(7812);let y="YOUR_COMPUTER_IP",j="http://".concat(y,":3001"),N="ws://".concat(y,":3001");function w(){let[e,t]=(0,a.useState)([]),[r,f]=(0,a.useState)(""),[m,x]=(0,a.useState)([]),[g,y]=(0,a.useState)(""),[w,S]=(0,a.useState)(!1),[I,k]=(0,a.useState)([]),[_,C]=(0,a.useState)(null),[O,E]=(0,a.useState)(!0),[R,T]=(0,a.useState)(""),[z,A]=(0,a.useState)(!1),[M,D]=(0,a.useState)([]),[P,V]=(0,a.useState)(null),[F,L]=(0,a.useState)(!1),$=(0,a.useRef)(null);(0,a.useRef)(void 0);let B=(0,n.useRouter)();(0,a.useEffect)(()=>{let e=localStorage.getItem("authToken");if(!e)return void B.push("/login");let t=localStorage.getItem("deviceId");t||(t="web-client-"+Math.random().toString(36).substring(7),localStorage.setItem("deviceId",t));let r=new WebSocket(N);return r.onopen=()=>{console.log("Connected to server"),L(!0),r.send(JSON.stringify({type:"authenticate",deviceId:t,token:e}))},r.onmessage=e=>{try{let t=JSON.parse(e.data);J(t)}catch(e){console.error("Failed to parse WS message",e)}},r.onclose=()=>{console.log("Disconnected from server"),L(!1)},r.onerror=e=>{console.error("WebSocket error:",e)},V(r),()=>{r.close()}},[B]),(0,a.useEffect)(()=>{let e=localStorage.getItem("userId");if(P&&_&&F&&e){let t="chat-".concat([e,_.id].sort().join("-"));P.send(JSON.stringify({type:"join_chat",chatId:t,userId:e,deviceId:localStorage.getItem("deviceId")}))}},[_,P,F]);let J=e=>{switch(e.type){case"message_history":t(e.messages||[]);break;case"new_chat_message":t(t=>t.find(t=>t.id===e.id)?t:[...t,e]);break;case"user_typing":e.isTyping?D(t=>[...t.filter(t=>t.userId!==e.userId),{userId:e.userId,timestamp:Date.now()}]):D(t=>t.filter(t=>t.userId!==e.userId));break;case"user_online":x(t=>t.map(t=>t.id===e.userId?{...t,online:!0}:t));break;case"user_offline":x(t=>t.map(t=>t.id===e.userId?{...t,online:!1}:t))}};(0,a.useEffect)(()=>{let e=async()=>{try{let e=await fetch("".concat(j,"/api/contacts"),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("authToken"))}});if(e.ok){let t=await e.json();x(t||[])}}catch(e){console.error("Failed to fetch contacts:",e)}};F&&e()},[F]);let U=async()=>{if(g.trim()){S(!0);try{let e=await fetch("".concat(j,"/api/users/search?q=").concat(g),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("authToken"))}});if(e.ok){let t=await e.json();k(t||[])}}catch(e){console.error("Search failed:",e)}finally{S(!1)}}},K=async e=>{try{(await fetch("".concat(j,"/api/contacts/add"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("authToken"))},body:JSON.stringify({contactId:e.id})})).ok&&(m.find(t=>t.id===e.id)||x(t=>[...t,e]),C(e))}catch(e){console.error("Add contact error:",e)}finally{y(""),k([])}},W=async()=>{let e=localStorage.getItem("userId");if(r.trim()&&_&&P&&F&&e)try{let s=crypto.randomUUID(),a="chat-".concat([e,_.id].sort().join("-")),n=r;O&&R&&(n=btoa(r+"|"+R)),P.send(JSON.stringify({type:"send_chat_message",chatId:a,senderId:e,content:n,messageId:s,timestamp:Date.now(),encrypted:O})),t(t=>[...t,{id:s,chatId:a,senderId:e,content:n,timestamp:Date.now(),encrypted:O,status:"sent"}]),f("")}catch(e){console.error("Failed to send message:",e)}};return(0,a.useEffect)(()=>{var e;null==(e=$.current)||e.scrollIntoView({behavior:"smooth"})},[e]),(0,s.jsxs)("div",{className:"h-screen bg-slate-900 flex flex-col md:flex-row",children:[(0,s.jsxs)("div",{className:"w-full md:w-80 bg-slate-800 border-r border-cyan-500/20 flex flex-col ".concat(_?"hidden md:flex":"flex"),children:[(0,s.jsxs)("div",{className:"p-4 border-b border-cyan-500/20 flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(l.A,{className:"w-6 h-6 text-cyan-500"}),(0,s.jsx)("span",{className:"font-bold text-white",children:"QuantumSafe"})]}),(0,s.jsx)(d.$,{variant:"ghost",size:"sm",onClick:()=>{localStorage.removeItem("authToken"),localStorage.removeItem("userId"),P&&P.close(),B.push("/login")},className:"text-slate-400",children:(0,s.jsx)(c.A,{className:"w-4 h-4"})})]}),(0,s.jsxs)("div",{className:"p-4 border-b border-cyan-500/20",children:[(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(u.p,{value:g,onChange:e=>y(e.target.value),placeholder:"Search users...",className:"bg-slate-700/50 border-cyan-500/30 text-white",onKeyPress:e=>"Enter"===e.key&&U()}),(0,s.jsx)(d.$,{size:"sm",onClick:U,className:"bg-cyan-500",children:"Search"})]}),I.length>0&&(0,s.jsx)("div",{className:"mt-2 space-y-2 bg-slate-900/50 p-2 rounded-lg border border-cyan-500/20 max-h-40 overflow-auto",children:I.map(e=>(0,s.jsxs)("div",{onClick:()=>K(e),className:"flex items-center gap-2 p-2 hover:bg-cyan-500/20 rounded cursor-pointer",children:[(0,s.jsx)(p,{className:"w-6 h-6",children:(0,s.jsx)(b,{className:"text-[10px]",children:e.name[0]})}),(0,s.jsx)("span",{className:"text-sm text-white",children:e.name})]},e.id))})]}),(0,s.jsx)(h,{className:"flex-1",children:(0,s.jsx)("div",{className:"p-2",children:m.map(e=>(0,s.jsx)("div",{onClick:()=>C(e),className:"p-3 rounded-lg cursor-pointer ".concat((null==_?void 0:_.id)===e.id?"bg-cyan-500/20 border border-cyan-500/30":"hover:bg-slate-700/50"),children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(p,{className:"w-10 h-10",children:(0,s.jsx)(b,{className:"bg-cyan-500/20 text-cyan-300",children:e.name[0]})}),e.online&&(0,s.jsx)("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 border-2 border-slate-800 rounded-full"})]}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"font-medium text-white truncate",children:e.name}),e.lastMessage&&(0,s.jsx)("p",{className:"text-sm text-slate-400 truncate",children:e.lastMessage})]})]})},e.id))})})]}),(0,s.jsx)("div",{className:"flex-1 flex flex-col ".concat(_?"flex":"hidden md:flex"),children:_?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"p-4 border-b border-cyan-500/20 bg-slate-800/50 flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(d.$,{variant:"ghost",size:"sm",className:"md:hidden text-white",onClick:()=>C(null),children:"Back"}),(0,s.jsx)(p,{className:"w-10 h-10",children:(0,s.jsx)(b,{children:_.name[0]})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"font-semibold text-white",children:_.name}),(0,s.jsx)("p",{className:"text-xs text-slate-400",children:_.online?"Online":"Offline"})]})]}),(0,s.jsx)(v.E,{variant:"outline",className:"text-cyan-400 border-cyan-500/30",children:"Secure"})]}),(0,s.jsx)(h,{className:"flex-1 p-4",children:(0,s.jsxs)("div",{className:"space-y-4",children:[e.map(e=>{let t=e.senderId===localStorage.getItem("userId");return(0,s.jsx)("div",{className:"flex ".concat(t?"justify-end":"justify-start"),children:(0,s.jsxs)("div",{className:"max-w-[80%] px-4 py-2 rounded-lg ".concat(t?"bg-cyan-500 text-white":"bg-slate-700 text-white"),children:[(0,s.jsx)("p",{className:"text-sm",children:(e=>{if(!e.encrypted)return e.content;try{return atob(e.content).split("|")[0]}catch(t){return e.content}})(e)}),(0,s.jsx)("span",{className:"text-[10px] opacity-70 block mt-1",children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},e.id)}),(0,s.jsx)("div",{ref:$})]})}),(0,s.jsx)("div",{className:"p-4 bg-slate-800/50 border-t border-cyan-500/20",children:(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(u.p,{value:r,onChange:e=>f(e.target.value),onKeyPress:e=>"Enter"===e.key&&W(),placeholder:"Message...",className:"bg-slate-700/50 border-cyan-500/30 text-white"}),(0,s.jsx)(d.$,{onClick:W,className:"bg-cyan-500",children:(0,s.jsx)(o.A,{className:"w-4 h-4"})})]})})]}):(0,s.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center text-slate-500",children:[(0,s.jsx)(i.A,{className:"w-16 h-16 mb-2 opacity-20"}),(0,s.jsx)("p",{children:"Select a contact to start"})]})})]})}},5016:(e,t,r)=>{"use strict";r.d(t,{cn:()=>n});var s=r(2821),a=r(5889);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.QP)((0,s.$)(t))}},6170:(e,t,r)=>{"use strict";r.d(t,{p:()=>l});var s=r(5155),a=r(2115),n=r(5016);let l=a.forwardRef((e,t)=>{let{className:r,type:a,...l}=e;return(0,s.jsx)("input",{type:a,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...l})});l.displayName="Input"},7003:(e,t,r)=>{"use strict";r.d(t,{$:()=>i});var s=r(5155),a=r(2115),n=r(7129),l=r(3101),c=r(5016);let o=(0,l.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),i=a.forwardRef((e,t)=>{let{className:r,variant:a,size:l,asChild:i=!1,...d}=e,u=i?n.DX:"button";return(0,s.jsx)(u,{className:(0,c.cn)(o({variant:a,size:l,className:r})),ref:t,...d})});i.displayName="Button"},7812:(e,t,r)=>{"use strict";r.d(t,{E:()=>c});var s=r(5155);r(2115);var a=r(3101),n=r(5016);let l=(0,a.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function c(e){let{className:t,variant:r,...a}=e;return(0,s.jsx)("div",{className:(0,n.cn)(l({variant:r}),t),...a})}},9861:(e,t,r)=>{Promise.resolve().then(r.bind(r,3724))}},e=>{e.O(0,[999,944,700,441,255,358],()=>e(e.s=9861)),_N_E=e.O()}]);